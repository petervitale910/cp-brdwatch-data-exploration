---
title: "BirdWatch: exploratory data analysis"
author: "Nathalie Bonnet"
date: 2026-01-08
format: html
---

The purpose of this document is to walk through preliminary data analysis for the MEDS 2026 BirdWatch Capstone project. 

Goals:
- explore the USGS California Gap status geodatabase and specifically visualize overlapping areas
- Look at the distribution of bird data over time
- Understand common bird species across space

```{r}
# Setup code

# Load in necessary libraries
library(tidyverse)
library(terra)
library(tidyterra)
library(here)
library(tmap)
library(janitor)
library(sf)
library(stars)
library(paletteer)
library(patchwork)
```

```{r}
# read in the data
area_search <- read_csv(here("data", "DataDownload_AreaSearch_2025-09-17_16-05-51.csv")) %>% 
  clean_names()

point_counts <- read_csv(here("data", "DataDownload_PointCount_2025-09-17_16-15-10.csv")) %>% 
  clean_names()

marshbirds <- read_csv(here("data", "DataDownload_SecretiveMarshbird_2025-09-17_16-16-50.csv")) %>% 
  clean_names()

gap <- st_read(here("data", "PADUS4_1_State_CA_GDB_KMZ", "PADUS4_1_StateCA.gdb"))
```

Explore area search data
```{r}
# How many unique plots were surveyed?
print(length(unique(area_search$plot_name)))

# How many unique species codes are there?
print(length(unique(area_search$species_code)))

area10 <- area_search %>% 
  group_by(species_code) %>% 
  summarise(count = n()) %>% 
  slice_max(order_by = count, n = 10) %>% 
  mutate(common_name = recode(species_code, "WREN" = 'Wrentit', "SOSP" = 'Song Sparrow', "CBCH" = 'Chestnut-backed Chickadee',"RCKI" = 'Ruby-crowned Kinglet', "ANHU" = 'Annas Hummingbird' , "SPTO" = 'Spotted Towhee',
"GCKI" = 'Golden-crowned Kinglet', "BEWR" = 'Bewicks Wren', "WIWA" = 'Wilsons Warbler',
"BUSH" = 'Bushtit'))

point10$species_code
point10 <- point_counts %>% 
  group_by(species_code) %>% 
  summarise(count = n()) %>% 
  slice_max(order_by = count, n = 10) %>% 
  mutate(common_name = recode(species_code, "RWBL"='Red-winged Blackbird', "SOSP"='Song Sparrow', "SPTO" ='Spotted Towhee',
"AMGO" ='American Goldfinch',"BHGR"='Black-headed Grosbeak', "BHCO"='Brown-headed Cowbird',
"BEWR"='Bewicks Wren',"HOFI"='House Finch', "WIWA"='Wilsons Warbler',
"HEWA"='Hermit Warbler'))

marsh12 <- marshbirds %>% 
  group_by(common_name) %>% 
  summarise(count = n()) %>% 
  mutate(common_name = if_else(
    is.na(common_name),
    "Unknown",
    common_name))

area10_plot <- ggplot(data = area10, aes(x = common_name, y = count, fill = common_name)) +
  geom_bar(stat = "identity") +
  theme_classic()+
    coord_flip() +
  labs(title = "Ten Most Counted Species in Each Type of Survey", 
       x = "Area Search") +
  theme(legend.position = "none", 
        axis.title.x = element_blank()) +
  scale_fill_paletteer_d("pals::tol")


point10_plot <- ggplot(data = point10, aes(x = common_name, y = count, fill = common_name)) +
  geom_bar(stat = "identity") +
  theme_classic()+
    coord_flip() +
  labs(x = "Point Count") +
  theme(legend.position = "none", 
        axis.title.x = element_blank()) +
  scale_fill_paletteer_d("pals::tol")


marsh_plot <- ggplot(data = marsh12, aes(x = common_name, y = count, fill = common_name)) +
  geom_bar(stat = "identity") +
  theme_classic()+
  coord_flip() +
  labs(x = "Marshbird Survey") +
  theme(legend.position = "none", 
        axis.title.x = element_blank()) +
  scale_fill_paletteer_d("pals::tol")

area10_plot /point10_plot / marsh_plot
```

Spatial exploration
```{r}
tm_shape(gap) +
  tm_polygons(fill = tm_fill())
```

```{r}
# Store vectors of protocols
area_prot <- unique(area_search$protocol_code)

point_prot <- unique(point_counts$protocol_code)

marsh_prot <- unique(marshbirds$protocol_code)

```

```{r}

```


